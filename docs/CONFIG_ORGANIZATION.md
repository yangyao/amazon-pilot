# é…ç½®æ–‡ä»¶ç»„ç»‡è¯´æ˜

## é…ç½®æ–‡ä»¶è¿ç§»

### 1. è¿ç§»åŸå› 

**ä¹‹å‰çš„ç»“æ„**:
```
internal/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ auth.go          # main() å‡½æ•°
â”‚   â””â”€â”€ etc/
â”‚       â””â”€â”€ auth-api.yaml
â””â”€â”€ product/
    â”œâ”€â”€ product.go       # main() å‡½æ•°
    â””â”€â”€ etc/
        â””â”€â”€ product-api.yaml
```

**é—®é¢˜**:
- `main()` å‡½æ•°åœ¨ `internal/` ç›®å½•
- é…ç½®æ–‡ä»¶ä¹Ÿåœ¨ `internal/` ç›®å½•
- ä¸ç¬¦åˆ Go é¡¹ç›®æœ€ä½³å®è·µ

**ç°åœ¨çš„ç»“æ„**:
```
cmd/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ main.go          # main() å‡½æ•°
â”‚   â””â”€â”€ etc/
â”‚       â””â”€â”€ auth-api.yaml
â””â”€â”€ product/
    â”œâ”€â”€ main.go          # main() å‡½æ•°
    â””â”€â”€ etc/
        â””â”€â”€ product-api.yaml
```

### 2. é…ç½®æ–‡ä»¶ç»„ç»‡åŸåˆ™

#### åŸåˆ™ 1: é…ç½®æ–‡ä»¶è·ŸéšæœåŠ¡
- æ¯ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶æ”¾åœ¨å¯¹åº”çš„ `cmd/{service}/etc/` ç›®å½•
- ä¾¿äºç‹¬ç«‹éƒ¨ç½²å’Œç®¡ç†
- ç¬¦åˆå¾®æœåŠ¡è®¾è®¡ç†å¿µ

#### åŸåˆ™ 2: æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- `cmd/` - å¯æ‰§è¡Œç¨‹åºå’Œé…ç½®
- `internal/` - ä¸šåŠ¡é€»è¾‘å®ç°
- `pkg/` - å¯å¤ç”¨çš„åº“ä»£ç 

### 3. æ–°çš„ç›®å½•ç»“æ„

```
amazon-pilot/
â”œâ”€â”€ cmd/                    # å¯æ‰§è¡Œç¨‹åºå’Œé…ç½®
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ main.go        # è®¤è¯æœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ etc/
â”‚   â”‚       â””â”€â”€ auth-api.yaml
â”‚   â”œâ”€â”€ product/
â”‚   â”‚   â”œâ”€â”€ main.go        # äº§å“æœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ etc/
â”‚   â”‚       â””â”€â”€ product-api.yaml
â”‚   â”œâ”€â”€ competitor/
â”‚   â”‚   â”œâ”€â”€ main.go        # ç«å“æœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ etc/
â”‚   â”‚       â””â”€â”€ competitor-api.yaml
â”‚   â”œâ”€â”€ optimization/
â”‚   â”‚   â”œâ”€â”€ main.go        # ä¼˜åŒ–æœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ etc/
â”‚   â”‚       â””â”€â”€ optimization-api.yaml
â”‚   â”œâ”€â”€ notification/
â”‚   â”‚   â”œâ”€â”€ main.go        # é€šçŸ¥æœåŠ¡å…¥å£
â”‚   â”‚   â””â”€â”€ etc/
â”‚   â”‚       â””â”€â”€ notification-api.yaml
â”‚   â”œâ”€â”€ worker/
â”‚   â”‚   â””â”€â”€ main.go        # åå°ä»»åŠ¡æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ scheduler/
â”‚   â”‚   â””â”€â”€ main.go        # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â””â”€â”€ monitor/
â”‚       â””â”€â”€ main.go        # ç›‘æ§ç•Œé¢
â”œâ”€â”€ internal/              # ä¸šåŠ¡é€»è¾‘å®ç°
â”‚   â”œâ”€â”€ auth/internal/     # è®¤è¯æœåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ product/internal/  # äº§å“æœåŠ¡é€»è¾‘
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### 4. é…ç½®æ–‡ä»¶ç±»å‹

#### æœåŠ¡é…ç½®æ–‡ä»¶
- **ä½ç½®**: `cmd/{service}/etc/{service}-api.yaml`
- **ç”¨é€”**: æœåŠ¡å¯åŠ¨é…ç½®
- **å†…å®¹**: ç«¯å£ã€æ•°æ®åº“è¿æ¥ã€Redis é…ç½®ç­‰

#### ç¯å¢ƒé…ç½®æ–‡ä»¶
- **ä½ç½®**: é¡¹ç›®æ ¹ç›®å½•
- **æ–‡ä»¶**: `.env`, `env.example`
- **ç”¨é€”**: ç¯å¢ƒå˜é‡é…ç½®
- **å†…å®¹**: æ•°æ®åº“ URLã€API å¯†é’¥ç­‰

#### ç›‘æ§é…ç½®æ–‡ä»¶
- **ä½ç½®**: `monitoring/`
- **æ–‡ä»¶**: `prometheus.yml`, `alert_rules.yml`
- **ç”¨é€”**: ç›‘æ§ç³»ç»Ÿé…ç½®

### 5. Docker æ„å»ºæ›´æ–°

#### ä¹‹å‰çš„ Dockerfile
```dockerfile
COPY --from=builder /app/internal/auth/etc /app/etc
```

#### ç°åœ¨çš„ Dockerfile
```dockerfile
COPY --from=builder /app/cmd/auth/etc /app/etc
```

### 6. é…ç½®æ–‡ä»¶è®¿é—®è·¯å¾„

#### å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨è®¤è¯æœåŠ¡
go run cmd/auth/main.go -f cmd/auth/etc/auth-api.yaml

# å¯åŠ¨äº§å“æœåŠ¡
go run cmd/product/main.go -f cmd/product/etc/product-api.yaml
```

#### ç”Ÿäº§ç¯å¢ƒ (Docker)
```bash
# é…ç½®æ–‡ä»¶åœ¨å®¹å™¨ä¸­çš„è·¯å¾„
/app/etc/auth-api.yaml
/app/etc/product-api.yaml
```

### 7. ä¼˜åŠ¿

#### âœ… æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- å¯æ‰§è¡Œç¨‹åºåœ¨ `cmd/`
- ä¸šåŠ¡é€»è¾‘åœ¨ `internal/`
- é…ç½®æ–‡ä»¶è·ŸéšæœåŠ¡

#### âœ… ä¾¿äºç‹¬ç«‹éƒ¨ç½²
- æ¯ä¸ªæœåŠ¡æœ‰ç‹¬ç«‹çš„é…ç½®
- å¯ä»¥ç‹¬ç«‹æ„å»ºå’Œéƒ¨ç½²
- ç¬¦åˆå¾®æœåŠ¡æ¶æ„

#### âœ… ç¬¦åˆ Go æ ‡å‡†
- éµå¾ª Go ç¤¾åŒºæœ€ä½³å®è·µ
- ä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ

### 8. è¿ç§»æ­¥éª¤

1. âœ… åˆ›å»º `cmd/{service}/etc/` ç›®å½•
2. âœ… å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°æ–°ä½ç½®
3. âœ… æ›´æ–° Dockerfile ä¸­çš„è·¯å¾„
4. âœ… æ›´æ–° main.go ä¸­çš„é…ç½®æ–‡ä»¶è·¯å¾„
5. ğŸ”„ åˆ é™¤æ—§çš„é…ç½®æ–‡ä»¶ (å¯é€‰)

### 9. æ³¨æ„äº‹é¡¹

- é…ç½®æ–‡ä»¶è·¯å¾„åœ¨ `main.go` ä¸­å·²ç»æ­£ç¡®è®¾ç½®
- Docker æ„å»ºè·¯å¾„å·²æ›´æ–°
- å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒéƒ½èƒ½æ­£å¸¸å·¥ä½œ
- ä¿æŒäº†é…ç½®æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ç»“æ„

è¿™æ ·çš„ç»„ç»‡æ–¹å¼æ›´ç¬¦åˆ Go é¡¹ç›®çš„æœ€ä½³å®è·µï¼Œä¹Ÿä¾¿äºåç»­çš„ç»´æŠ¤å’Œæ‰©å±•ã€‚
