# é¡¹ç›®ç»“æ„ä¼˜åŒ–å®Œæˆ ğŸ‰

## æ–°çš„é¡¹ç›®å¸ƒå±€

```
amazon-pilot/
â”œâ”€â”€ cmd/                      # ğŸš€ åº”ç”¨ç¨‹åºå…¥å£ç‚¹ï¼ˆç¬¦åˆGoæ ‡å‡†ï¼‰
â”‚   â”œâ”€â”€ auth/                 # è®¤è¯æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ competitor/           # ç«å“åˆ†ææœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ monitor/              # ç›‘æ§æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ notification/         # é€šçŸ¥æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ optimization/         # ä¼˜åŒ–å»ºè®®æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ product/              # äº§å“ç®¡ç†æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ scheduler/            # ä»»åŠ¡è°ƒåº¦å™¨å…¥å£
â”‚   â””â”€â”€ worker/               # åå°ä»»åŠ¡æ‰§è¡Œå™¨å…¥å£
â”œâ”€â”€ pkg/                      # ğŸ“š å¯å¯¼å‡ºçš„å…¬å…±åº“
â”‚   â”œâ”€â”€ client/               # APIå®¢æˆ·ç«¯ (å¾…å®ç°)
â”‚   â”œâ”€â”€ types/                # âœ… å…¬å…±ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•° (å¾…å®ç°)
â”œâ”€â”€ internal/                 # ğŸ”’ ç§æœ‰ä»£ç 
â”‚   â”œâ”€â”€ pkg/                  # ğŸ§° å†…éƒ¨å…±äº«åŒ…
â”‚   â”‚   â”œâ”€â”€ auth/             # è®¤è¯ç›¸å…³å·¥å…· (å¾…å®ç°)
â”‚   â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç† (å¾…å®ç°)
â”‚   â”‚   â”œâ”€â”€ database/         # âœ… æ•°æ®åº“å·¥å…·
â”‚   â”‚   â”œâ”€â”€ errors/           # âœ… é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ logger/           # âœ… æ—¥å¿—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶ (å¾…å®ç°)
â”‚   â”‚   â””â”€â”€ queue/            # é˜Ÿåˆ—å·¥å…· (å¾…å®ç°)
â”‚   â”œâ”€â”€ auth/                 # ğŸ” è®¤è¯æœåŠ¡ (go-zeroç”Ÿæˆ)
â”‚   â”œâ”€â”€ competitor/           # ğŸ“Š ç«å“æœåŠ¡ (go-zeroç”Ÿæˆ)
â”‚   â”œâ”€â”€ notification/         # ğŸ“¨ é€šçŸ¥æœåŠ¡ (go-zeroç”Ÿæˆ)
â”‚   â”œâ”€â”€ optimization/         # ğŸ¯ ä¼˜åŒ–æœåŠ¡ (go-zeroç”Ÿæˆ)
â”‚   â””â”€â”€ product/              # ğŸ“¦ äº§å“æœåŠ¡ (go-zeroç”Ÿæˆ)
â”œâ”€â”€ api/                      # ğŸ“‹ APIå®šä¹‰ç®¡ç†
â”‚   â”œâ”€â”€ openapi/              # âœ… go-zero APIå®šä¹‰æ–‡ä»¶
â”‚   â”œâ”€â”€ proto/                # Protocol Bufferå®šä¹‰
â”‚   â””â”€â”€ docs/                 # APIæ–‡æ¡£
â”œâ”€â”€ deployments/              # ğŸš€ éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ compose/              # âœ… Docker Compose
â”‚   â”œâ”€â”€ k8s/                  # Kubernetesé…ç½®
â”‚   â””â”€â”€ helm/                 # Helm Charts
â”œâ”€â”€ docker/                   # ğŸ³ Dockeré…ç½® (âœ… å·²æ›´æ–°è·¯å¾„)
â”œâ”€â”€ docs/                     # ğŸ“– é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ scripts/                  # ğŸ”§ å·¥å…·è„šæœ¬
â””â”€â”€ go.mod                    # Goæ¨¡å—å®šä¹‰
```

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. ç›®å½•ç»“æ„æ ‡å‡†åŒ–
- **ç§»åŠ¨ `internal/cmd` â†’ `cmd`**: ç¬¦åˆGoæ ‡å‡†é¡¹ç›®å¸ƒå±€
- **åˆ›å»º `pkg/`**: å¯å¯¼å‡ºçš„å…¬å…±åº“ç›®å½•
- **åˆ›å»º `internal/pkg/`**: å†…éƒ¨å…±äº«ä»£ç ç›®å½•
- **åˆ›å»º `api/`**: APIå®šä¹‰é›†ä¸­ç®¡ç†
- **åˆ›å»º `deployments/`**: éƒ¨ç½²é…ç½®ç»Ÿä¸€ç®¡ç†

### 2. å…±äº«ä»£ç åŒ…åˆ›å»º
- **`pkg/types/common.go`**: ç»Ÿä¸€å“åº”ç»“æ„ã€åˆ†é¡µç±»å‹
- **`internal/pkg/database/database.go`**: æ•°æ®åº“è¿æ¥å·¥å…·
- **`internal/pkg/logger/logger.go`**: åŸºäºgo-zeroçš„æ—¥å¿—æ¥å£
- **`internal/pkg/errors/errors.go`**: ç»Ÿä¸€é”™è¯¯å¤„ç†

### 3. æ„å»ºé…ç½®æ›´æ–°
- **Dockeré…ç½®**: æ‰€æœ‰Dockerfileå·²æ›´æ–°è·¯å¾„ `internal/cmd` â†’ `cmd`
- **éƒ¨ç½²é…ç½®**: docker-compose.ymlç§»åŠ¨åˆ° `deployments/compose/`
- **APIæ–‡ä»¶**: å¤åˆ¶åˆ° `api/openapi/` è¿›è¡Œé›†ä¸­ç®¡ç†

### 4. å¼€å‘ä¾¿åˆ©è„šæœ¬
- **`scripts/start-service.sh`**: å¿«é€Ÿå¯åŠ¨æœåŠ¡
- **`scripts/build-all.sh`**: æ„å»ºæ‰€æœ‰æœåŠ¡

## ğŸš€ æ–°çš„å¼€å‘æµç¨‹

### å¯åŠ¨æœåŠ¡
```bash
# ä½¿ç”¨ä¾¿åˆ©è„šæœ¬
./scripts/start-service.sh auth

# æˆ–ç›´æ¥è¿è¡Œ
go run cmd/auth/main.go -f cmd/auth/etc/auth-api.yaml
```

### APIå¼€å‘ (ä¿æŒgo-zeroä¾¿åˆ©æ€§)
```bash
# 1. ä¿®æ”¹APIå®šä¹‰ (ç»§ç»­åœ¨åŸä½ç½®)
vim internal/auth/auth.api

# 2. ç”Ÿæˆä»£ç  (ä½¿ç”¨ç°æœ‰è„šæœ¬)
./scripts/goctl-monorepo.sh -a ./internal/auth/auth.api -s auth

# 3. å®ç°ä¸šåŠ¡é€»è¾‘æ—¶ä½¿ç”¨å…±äº«åŒ…
```

### ä½¿ç”¨å…±äº«ä»£ç åŒ…
```go
import (
    "amazonpilot/pkg/types"              // å…¬å…±ç±»å‹
    "amazonpilot/internal/pkg/database"  // æ•°æ®åº“å·¥å…·
    "amazonpilot/internal/pkg/logger"    // æ—¥å¿—å·¥å…·
    "amazonpilot/internal/pkg/errors"    // é”™è¯¯å¤„ç†
)

// ç¤ºä¾‹ï¼šä½¿ç”¨ç»Ÿä¸€å“åº”ç»“æ„
func (l *PingLogic) Ping() (resp *types.PingResponse, err error) {
    return &types.PingResponse{
        Status:    "ok",
        Message:   "auth service is running",
        Timestamp: time.Now().Unix(),
    }, nil
}
```

### æ„å»ºå’Œéƒ¨ç½²
```bash
# æ„å»ºæ‰€æœ‰æœåŠ¡
./scripts/build-all.sh

# Dockeræ„å»º (å·²æ›´æ–°è·¯å¾„)
docker build -t auth-service -f docker/Dockerfile.auth .

# ä½¿ç”¨Docker Compose
cd deployments/compose && docker-compose up
```

## ğŸ”„ ä¿æŒçš„ä¾¿åˆ©æ€§

### âœ… go-zeroè„šæ‰‹æ¶
- APIå®šä¹‰æ–‡ä»¶ä¿æŒåœ¨ `internal/{service}/{service}.api`
- ä»£ç ç”Ÿæˆæµç¨‹å®Œå…¨ä¸å˜
- ç”Ÿæˆçš„ç›®å½•ç»“æ„ä¿æŒå…¼å®¹

### âœ… å¼€å‘ä½“éªŒ
- æ‰€æœ‰ç°æœ‰å¼€å‘æµç¨‹éƒ½èƒ½æ­£å¸¸å·¥ä½œ
- æ·»åŠ äº†æ›´å¤šä¾¿åˆ©è„šæœ¬
- æ›´æ¸…æ™°çš„é¡¹ç›®ç»„ç»‡

### âœ… éƒ¨ç½²æµç¨‹
- Dockeræ„å»ºæ­£å¸¸å·¥ä½œ
- æ‰€æœ‰é…ç½®æ–‡ä»¶å·²æ›´æ–°
- æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### é«˜ä¼˜å…ˆçº§
1. **å®Œå–„å…±äº«ä»£ç åŒ…**: å®ç° `internal/pkg/auth`, `internal/pkg/middleware` ç­‰
2. **ä½¿ç”¨ç»Ÿä¸€ç±»å‹**: åœ¨ç°æœ‰æœåŠ¡ä¸­é€æ­¥ä½¿ç”¨ `pkg/types` ä¸­çš„ç»Ÿä¸€ç±»å‹
3. **ç»Ÿä¸€é”™è¯¯å¤„ç†**: ä½¿ç”¨ `internal/pkg/errors` æ›¿æ¢ç°æœ‰é”™è¯¯å¤„ç†

### ä¸­ä¼˜å…ˆçº§  
1. **APIæ–‡æ¡£ç”Ÿæˆ**: åŸºäº `api/openapi/` ç”Ÿæˆç»Ÿä¸€æ–‡æ¡£
2. **å®Œå–„å·¥å…·è„šæœ¬**: æ·»åŠ æµ‹è¯•ã€éƒ¨ç½²ç­‰ä¾¿åˆ©è„šæœ¬
3. **Kubernetesé…ç½®**: å®Œå–„ `deployments/k8s/` é…ç½®

### ä½ä¼˜å…ˆçº§
1. **å®¢æˆ·ç«¯SDK**: åŸºäºAPIå®šä¹‰ç”Ÿæˆå„è¯­è¨€å®¢æˆ·ç«¯
2. **ç›‘æ§é›†æˆ**: ç»Ÿä¸€çš„ç›‘æ§å’Œæ—¥å¿—æ”¶é›†
3. **CI/CDä¼˜åŒ–**: åˆ©ç”¨æ–°ç»“æ„ä¼˜åŒ–æ„å»ºæµç¨‹

## âœ… éªŒè¯ç»“æœ

```bash
# æœåŠ¡å¯åŠ¨æ­£å¸¸
$ go run cmd/auth/main.go -f cmd/auth/etc/auth-api.yaml
Starting auth server at 0.0.0.0:8888...

# APIå·¥ä½œæ­£å¸¸
$ curl http://localhost:8888/ping
{"status":"ok","message":"auth service is running","timestamp":1757681992}

# æ„å»ºæ­£å¸¸
$ ./scripts/build-all.sh
ğŸ—ï¸  æ„å»ºæ‰€æœ‰æœåŠ¡...
ğŸ“¦ æ„å»º auth...
âœ… auth æ„å»ºæˆåŠŸ
...
```

## ğŸ† ä¼˜åŒ–æˆæœ

1. **âœ… ç¬¦åˆGoæœ€ä½³å®è·µ**: é¡¹ç›®ç»“æ„ç¬¦åˆ `golang-standards/project-layout`
2. **âœ… ä¿æŒå¼€å‘ä¾¿åˆ©æ€§**: go-zeroè„šæ‰‹æ¶åŠŸèƒ½å®Œæ•´ä¿ç•™  
3. **âœ… ä»£ç å¤ç”¨èƒ½åŠ›**: å…±äº«ä»£ç åŒ…å‡å°‘é‡å¤å¼€å‘
4. **âœ… æ›´å¥½çš„å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œæ¨¡å—è¾¹ç•Œ
5. **âœ… éƒ¨ç½²é…ç½®ç»Ÿä¸€**: é›†ä¸­çš„éƒ¨ç½²é…ç½®ç®¡ç†

é¡¹ç›®ç°åœ¨å…·å¤‡äº†ä¸šç•Œæœ€ä½³å®è·µçš„ç»“æ„ï¼ŒåŒæ—¶ä¿æŒäº†go-zeroæ¡†æ¶çš„æ‰€æœ‰ä¾¿åˆ©æ€§ï¼ ğŸ‰