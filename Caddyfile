# 主域名配置
amazon-pilot.phpman.top {
    # API Gateway 路由
    route {
        # 前端静态文件
        handle / {
            reverse_proxy frontend:3000
        }
        
        # API 路由
        handle /api/* {
            # 认证服务
            handle /api/auth/* {
                reverse_proxy auth-service:8001
            }
            
            # 产品服务
            handle /api/products/* {
                reverse_proxy product-service:8002
            }
            
            # 竞品服务
            handle /api/competitors/* {
                reverse_proxy competitor-service:8003
            }
            
            # 优化服务
            handle /api/optimization/* {
                reverse_proxy optimization-service:8004
            }
            
            # 通知服务
            handle /api/notifications/* {
                reverse_proxy notification-service:8005
            }
            
            # 健康检查
            handle /api/health {
                respond "OK" 200
            }
            
            # 默认 API 路由
            handle {
                respond "Amazon Pilot API" 200
            }
        }
    }
    
    # 日志配置
    log {
        output file /var/log/caddy/access.log {
            roll_size 100mb
            roll_keep 5
            roll_keep_for 720h
        }
        format json
    }
    
    # 错误日志
    errors {
        log {
            output file /var/log/caddy/error.log {
                roll_size 100mb
                roll_keep 5
                roll_keep_for 720h
            }
        }
    }
}

# 任务监控界面
monitor.amazon-pilot.phpman.top {
    reverse_proxy asynq-monitor:5555
    
    # 基本认证保护
    basicauth {
        admin $2a$14$your-hashed-password-here
    }
    
    # 日志配置
    log {
        output file /var/log/caddy/monitor-access.log {
            roll_size 100mb
            roll_keep 5
            roll_keep_for 720h
        }
        format json
    }
}

# Grafana 监控界面
grafana.amazon-pilot.phpman.top {
    reverse_proxy grafana:3000
    
    # 基本认证保护
    basicauth {
        admin $2a$14$your-hashed-password-here
    }
    
    # 日志配置
    log {
        output file /var/log/caddy/grafana-access.log {
            roll_size 100mb
            roll_keep 5
            roll_keep_for 720h
        }
        format json
    }
}
